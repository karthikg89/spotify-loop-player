(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,function(e,t,a){e.exports=a(16)},,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(2),l=a.n(c),s=(a(13),a(3)),o=a.n(s);a(14),a(15);var i=()=>r.a.createElement("div",{className:"shortcuts-container"},r.a.createElement("div",{className:"shortcuts-header"},r.a.createElement("h2",null,"Keyboard Shortcuts"),r.a.createElement("span",{className:"arrow"},"\u25bc")),r.a.createElement("div",{className:"shortcuts-list"},r.a.createElement("div",{className:"shortcuts-column"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"Space"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Play/Pause")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"R"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Restart Loop")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"S"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Set Loop Start")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"E"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Set Loop End")))),r.a.createElement("div",{className:"shortcuts-column"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"\u2190/\u2192"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Move Loop Start")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"Shift + \u2190/\u2192"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Move Loop End")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"Ctrl + \u2190/\u2192"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Previous/Next\xa0Track"))))));const u=new o.a;var m=function(){const[e,t]=Object(n.useState)(null),[a,c]=Object(n.useState)(null),[l,s]=Object(n.useState)(null),[o,m]=Object(n.useState)(0),[d,p]=Object(n.useState)(0),[b,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(0),[k,y]=Object(n.useState)(0),[v,g]=Object(n.useState)(null),[N,S]=Object(n.useState)(null),[w,j]=Object(n.useState)(!1),[O,C]=Object(n.useState)(!1),[x,T]=Object(n.useState)(!1),[R,M]=Object(n.useState)(120),L=Object(n.useRef)(null),$=Object(n.useRef)(null),D=Object(n.useRef)(!1),P=Object(n.useRef)(null),A=Object(n.useRef)(null),I=Object(n.useRef)(null);Object(n.useEffect)(()=>{const e=window.location.hash.substring(1).split("&").reduce((e,t)=>{let a=t.split("=");return e[a[0]]=decodeURIComponent(a[1]),e},{});e.access_token&&(t(e.access_token),u.setAccessToken(e.access_token))},[]),Object(n.useEffect)(()=>{if(e&&!document.getElementById("spotify-player")){const t=document.createElement("script");t.id="spotify-player",t.src="https://sdk.scdn.co/spotify-player.js",t.async=!0,document.body.appendChild(t),window.onSpotifyWebPlaybackSDKReady=(()=>{const t=new window.Spotify.Player({name:"Loop Player",getOAuthToken:t=>{t(e)}});t.addListener("ready",e=>{let{device_id:t}=e;console.log("Ready with Device ID",t),u.transferMyPlayback([t])}),t.connect(),c(t)})}},[e]),Object(n.useEffect)(()=>{a&&a.addListener("player_state_changed",e=>{if(e){S(e);const t=e.track_window.current_track;s({name:t.name,artist:t.artists[0].name,duration:e.duration,uri:t.uri,id:t.id}),y(e.duration)}})},[a]);const K=Object(n.useCallback)(async()=>{if(!a)return;if(x)return P.current&&(clearTimeout(P.current),P.current=null),I.current&&(I.current.stop(),I.current=null),A.current&&(A.current.close(),A.current=null),void T(!1);await a.pause(),T(!0),A.current=new AudioContext,I.current=A.current.createOscillator();const e=A.current.createGain();I.current.connect(e),e.connect(A.current.destination);const t=6e4/R;for(let a=0;a<4;a++){const n=A.current.currentTime+a*t/1e3;I.current.frequency.setValueAtTime(0===a?1e3:800,n),e.gain.setValueAtTime(0,n),e.gain.linearRampToValueAtTime(.5,n+.001),e.gain.linearRampToValueAtTime(0,n+.1)}I.current.start(),I.current.stop(A.current.currentTime+4*t/1e3),P.current=setTimeout(async()=>{T(!1),P.current=null,I.current=null,A.current=null,a&&(await a.seek(o),await a.resume(),f(!0))},4*t)},[a,o,x,R]);Object(n.useEffect)(()=>{if(a){const e=setInterval(async()=>{const e=await a.getCurrentState();e&&(h(e.position),b&&e.position>=d&&!v&&!x&&(O?K():a.seek(o).catch(e=>console.error("Seek error:",e))))},100);return()=>clearInterval(e)}},[a,b,o,d,v,O,K,x]);const _=Object(n.useCallback)(e=>{const t=Math.min(o+e,d);m(t),a&&a.seek(t).catch(e=>console.error("Seek error:",e))},[o,d,m,a]),B=Object(n.useCallback)(e=>{const t=Math.max(d+e,o);p(t)},[d,o,p]),U=Object(n.useCallback)(async()=>{a&&(f(!1),await a.nextTrack())},[a,f]),z=Object(n.useCallback)(async()=>{a&&(f(!1),await a.previousTrack())},[a,f]),V=Object(n.useCallback)(async()=>{if(!a)return;const e=await a.getCurrentState();(null===e||void 0===e?void 0:e.paused)?await a.resume():await a.pause()},[a]),W=Object(n.useCallback)(()=>{a&&a.seek(o).catch(e=>console.error("Seek error:",e))},[a,o]),X=Object(n.useCallback)(()=>{f(!b),!b&&a&&a.seek(o).catch(e=>console.error("Seek error:",e))},[b,a,o]);Object(n.useEffect)(()=>()=>{P.current&&clearTimeout(P.current),I.current&&I.current.stop(),A.current&&A.current.close()},[]);const q=Object(n.useCallback)(()=>{a&&a.getCurrentState().then(e=>{if(e){const t=Math.min(e.position,d);m(t)}})},[a,d]),F=Object(n.useCallback)(()=>{a&&a.getCurrentState().then(e=>{if(e){const t=Math.max(e.position,o);p(t)}})},[a,o]);Object(n.useEffect)(()=>{const e=e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.code){case"Space":e.preventDefault(),V();break;case"KeyR":e.preventDefault(),O?K():W();break;case"KeyS":e.preventDefault(),q();break;case"KeyE":e.preventDefault(),F();break;case"ArrowRight":e.ctrlKey||e.metaKey?(e.preventDefault(),U()):e.shiftKey?(e.preventDefault(),B(10)):(e.preventDefault(),_(10));break;case"ArrowLeft":e.ctrlKey||e.metaKey?(e.preventDefault(),z()):e.shiftKey?(e.preventDefault(),B(-10)):(e.preventDefault(),_(-10))}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[V,U,z,_,B,W,K,O,q,F]);const J=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`,G=e=>{const t=Math.floor(e/6e4),a=Math.floor(e%6e4/1e3),n=Math.floor(e%1e3/10);return`${t}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},H=(e,t)=>{g(t),e.preventDefault()},Q=e=>{if(!v)return;const t=document.querySelector(".timeline").getBoundingClientRect(),a=Math.max(0,Math.min(1,(e.clientX-t.left)/t.width))*k;if("start"===v){const e=Math.min(a,d);m(e)}else if("end"===v){const e=Math.max(a,o);p(e)}},Y=Object(n.useCallback)(()=>{"start"===v&&b&&a&&a.seek(o).catch(e=>console.error("Seek error:",e)),D.current=!0,setTimeout(()=>{D.current=!1},100),g(null)},[v,b,a,o]);return Object(n.useEffect)(()=>{if(v)return document.addEventListener("mousemove",Q),document.addEventListener("mouseup",Y),()=>{document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",Y)}},[v,Q,Y]),r.a.createElement("div",{className:"App"},e?r.a.createElement("div",{className:"player-container"},l&&r.a.createElement("div",{className:"track-info"},r.a.createElement("h2",null,l.name),r.a.createElement("h3",null,l.artist)),r.a.createElement("div",{className:"timeline-container"},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"}},r.a.createElement("span",null,J(E)),r.a.createElement("span",null,J(k))),r.a.createElement("div",{className:"timeline",onClick:e=>{if(D.current)return;const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left)/t.width,r=n*k,c=d/k,l=2/t.width;Math.abs(n-c)<l||a.seek(r)},style:{position:"relative",height:"40px",background:"#ddd",cursor:"pointer",borderRadius:"20px",margin:"0 0 10px 0"}},r.a.createElement("div",{className:"progress",style:{position:"absolute",left:0,top:0,height:"100%",width:`${E/k*100}%`,background:"#1db954",borderRadius:"20px"}}),r.a.createElement("div",{className:"loop-region",style:{position:"absolute",left:`${o/k*100}%`,width:`${(d-o)/k*100}%`,height:"100%",background:"rgba(29, 185, 84, 0.3)",borderRadius:"20px"}}),r.a.createElement("div",{className:"loop-start",style:{position:"absolute",left:`${o/k*100}%`,height:"60px",top:"-10px",width:"4px",background:"#ffffff",border:"2px solid #1db954",cursor:"ew-resize",zIndex:2,borderRadius:"2px"},onMouseDown:e=>H(e,"start")}),r.a.createElement("div",{className:"loop-end",style:{position:"absolute",left:`${d/k*100}%`,height:"60px",top:"-10px",width:"4px",background:"#ffffff",border:"2px solid #1db954",cursor:"ew-resize",zIndex:2,borderRadius:"2px"},onMouseDown:e=>H(e,"end")})),r.a.createElement("div",{className:"time-display",style:{position:"relative",height:"20px",marginTop:"15px"}},Math.abs((d-o)/k)>.1?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"timestamp-container",style:{left:`${o/k*100}%`,color:"#1db954",fontWeight:"bold",cursor:"default"},title:"Use arrow keys to adjust start, Shift+arrow keys to adjust end"},r.a.createElement("span",null,G(o))),r.a.createElement("div",{className:"timestamp-container",style:{left:`${d/k*100}%`,color:"#1db954",fontWeight:"bold",cursor:"default"},title:"Use arrow keys to adjust start, Shift+arrow keys to adjust end"},r.a.createElement("span",null,G(d)))):r.a.createElement("div",{style:{position:"absolute",left:`${(o+d)/2/k*100}%`,transform:"translateX(-50%)",color:"#1db954",fontWeight:"bold"}},G(o)," - ",G(d)))),w&&r.a.createElement("div",{className:"loop-inputs"},r.a.createElement("label",null,"Loop Start (ms):",r.a.createElement("input",{type:"number",ref:L,value:o,onChange:e=>{const t=Number(e.target.value);m(t),a&&a.seek(t).catch(e=>console.error("Seek error:",e))}})),r.a.createElement("label",null,"Loop End (ms):",r.a.createElement("input",{type:"number",ref:$,value:d,onChange:e=>{const t=Number(e.target.value);p(t),a&&a.seek(t).catch(e=>console.error("Seek error:",e))}}))),r.a.createElement("div",{className:"controls",style:{marginTop:"20px",display:"flex",justifyContent:"center",gap:"15px",alignItems:"center"}},r.a.createElement("button",{onClick:z,className:"control-button","aria-label":"Previous track",title:"Previous Track"},"\u23ee"),r.a.createElement("button",{onClick:V,className:"control-button","aria-label":"Play or pause",title:(null===N||void 0===N?void 0:N.paused)?"Play":"Pause"},(null===N||void 0===N?void 0:N.paused)?"\u25b6":"\u23f8"),r.a.createElement("button",{onClick:U,className:"control-button","aria-label":"Next track",title:"Next Track"},"\u23ed"),r.a.createElement("button",{onClick:X,className:`control-button ${b?"active":""}`,"aria-label":"Toggle loop",title:b?"Stop Loop":"Start Loop"},"\ud83d\udd01"),r.a.createElement("div",{className:`count-in-group ${O?"count-in-expanded":""}`},r.a.createElement("button",{onClick:()=>C(!O),className:`control-button ${O?"active":""}`,title:"Toggle Count-in"},"\ud83c\udfb5"),O&&r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"number",value:R,onChange:e=>{const t=Math.max(1,Math.min(300,Number(e.target.value)));M(t)},title:"BPM for count-in"}),r.a.createElement("label",null,"BPM"),r.a.createElement("button",{onClick:K,className:"control-button",disabled:x,title:"Start with Count-in"},x?"1-2-3-4":"Start")))),r.a.createElement(i,null)," "):r.a.createElement("button",{onClick:()=>{window.location.href=`https://accounts.spotify.com/authorize?client_id=90578a866be642ed97064a098d97fecd&redirect_uri=${encodeURIComponent("https://karthikg89.github.io/spotify-loop-player/")}&scope=${encodeURIComponent(["user-read-playback-state","user-modify-playback-state","streaming"].join(" "))}&response_type=token`}},"Login with Spotify"))};l.a.createRoot(document.getElementById("root")).render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(m,null)))}],[[4,1,2]]]);
//# sourceMappingURL=main.1cf9dadf.chunk.js.map