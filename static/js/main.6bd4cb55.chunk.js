(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,function(e,t,a){e.exports=a(16)},,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(2),l=a.n(c),o=(a(13),a(3)),s=a.n(o);a(14),a(15);var i=()=>r.a.createElement("div",{className:"shortcuts-container"},r.a.createElement("div",{className:"shortcuts-header"},r.a.createElement("h2",null,"Keyboard Shortcuts"),r.a.createElement("span",{className:"arrow"},"\u25bc")),r.a.createElement("div",{className:"shortcuts-list"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"Space"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Play/Pause")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"Arrow Left"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Move Start Loop Backward by 10ms")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"Arrow Right"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Move Start Loop Forward by 10ms")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"Shift + Arrow Left"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Move End Loop Backward by 10ms")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"Shift + Arrow Right"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Move End Loop Forward by 10ms")),r.a.createElement("li",null,r.a.createElement("span",{className:"key"},"R"),r.a.createElement("span",{className:"colon"},":"),r.a.createElement("span",{className:"description"},"Restart Loop (with count-in if enabled)")))));const u=new s.a;var m=function(){const[e,t]=Object(n.useState)(null),[a,c]=Object(n.useState)(null),[l,o]=Object(n.useState)(null),[s,m]=Object(n.useState)(0),[d,p]=Object(n.useState)(0),[b,f]=Object(n.useState)(!1),[E,y]=Object(n.useState)(0),[h,k]=Object(n.useState)(0),[v,g]=Object(n.useState)(null),[w,N]=Object(n.useState)(null),[S,j]=Object(n.useState)(!1),[O,x]=Object(n.useState)(!1),[C,R]=Object(n.useState)(!1),[T,M]=Object(n.useState)(120),L=Object(n.useRef)(null),$=Object(n.useRef)(null),A=Object(n.useRef)(!1),D=Object(n.useRef)(null),P=Object(n.useRef)(null),I=Object(n.useRef)(null);Object(n.useEffect)(()=>{const e=window.location.hash.substring(1).split("&").reduce((e,t)=>{let a=t.split("=");return e[a[0]]=decodeURIComponent(a[1]),e},{});e.access_token&&(t(e.access_token),u.setAccessToken(e.access_token))},[]),Object(n.useEffect)(()=>{if(e&&!document.getElementById("spotify-player")){const t=document.createElement("script");t.id="spotify-player",t.src="https://sdk.scdn.co/spotify-player.js",t.async=!0,document.body.appendChild(t),window.onSpotifyWebPlaybackSDKReady=(()=>{const t=new window.Spotify.Player({name:"Loop Player",getOAuthToken:t=>{t(e)}});t.addListener("ready",e=>{let{device_id:t}=e;console.log("Ready with Device ID",t),u.transferMyPlayback([t])}),t.connect(),c(t)})}},[e]),Object(n.useEffect)(()=>{a&&a.addListener("player_state_changed",e=>{if(e){N(e);const t=e.track_window.current_track;o({name:t.name,artist:t.artists[0].name,duration:e.duration,uri:t.uri,id:t.id}),k(e.duration)}})},[a]);const _=Object(n.useCallback)(async()=>{if(!a)return;if(C)return D.current&&(clearTimeout(D.current),D.current=null),I.current&&(I.current.stop(),I.current=null),P.current&&(P.current.close(),P.current=null),void R(!1);await a.pause(),R(!0),P.current=new AudioContext,I.current=P.current.createOscillator();const e=P.current.createGain();I.current.connect(e),e.connect(P.current.destination);const t=6e4/T;for(let a=0;a<4;a++){const n=P.current.currentTime+a*t/1e3;I.current.frequency.setValueAtTime(0===a?1e3:800,n),e.gain.setValueAtTime(0,n),e.gain.linearRampToValueAtTime(.5,n+.001),e.gain.linearRampToValueAtTime(0,n+.1)}I.current.start(),I.current.stop(P.current.currentTime+4*t/1e3),D.current=setTimeout(async()=>{R(!1),D.current=null,I.current=null,P.current=null,a&&(await a.seek(s),await a.resume(),f(!0))},4*t)},[a,s,C,T]);Object(n.useEffect)(()=>{if(a){const e=setInterval(async()=>{const e=await a.getCurrentState();e&&(y(e.position),b&&e.position>=d&&!v&&!C&&(O?_():a.seek(s).catch(e=>console.error("Seek error:",e))))},100);return()=>clearInterval(e)}},[a,b,s,d,v,O,_,C]);const B=Object(n.useCallback)(e=>{const t=Math.min(s+e,d);m(t),a&&a.seek(t).catch(e=>console.error("Seek error:",e))},[s,d,m,a]),K=Object(n.useCallback)(e=>{const t=Math.max(d+e,s);p(t)},[d,s,p]),U=Object(n.useCallback)(async()=>{a&&(f(!1),await a.nextTrack())},[a,f]),z=Object(n.useCallback)(async()=>{a&&(f(!1),await a.previousTrack())},[a,f]),F=Object(n.useCallback)(async()=>{if(!a)return;const e=await a.getCurrentState();(null===e||void 0===e?void 0:e.paused)?await a.resume():await a.pause()},[a]),V=Object(n.useCallback)(()=>{a&&a.seek(s).catch(e=>console.error("Seek error:",e))},[a,s]),W=Object(n.useCallback)(()=>{f(!b),!b&&a&&a.seek(s).catch(e=>console.error("Seek error:",e))},[b,a,s]);Object(n.useEffect)(()=>()=>{D.current&&clearTimeout(D.current),I.current&&I.current.stop(),P.current&&P.current.close()},[]),Object(n.useEffect)(()=>{const e=e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.code){case"Space":e.preventDefault(),F();break;case"KeyR":e.preventDefault(),O?_():V();break;case"ArrowRight":e.ctrlKey||e.metaKey?(e.preventDefault(),U()):e.shiftKey?(e.preventDefault(),K(10)):(e.preventDefault(),B(10));break;case"ArrowLeft":e.ctrlKey||e.metaKey?(e.preventDefault(),z()):e.shiftKey?(e.preventDefault(),K(-10)):(e.preventDefault(),B(-10))}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[F,U,z,B,K,V,_,O]);const X=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`,q=e=>{const t=Math.floor(e/6e4),a=Math.floor(e%6e4/1e3),n=Math.floor(e%1e3/10);return`${t}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},J=(e,t)=>{g(t),e.preventDefault()},G=e=>{if(!v)return;const t=document.querySelector(".timeline").getBoundingClientRect(),a=Math.max(0,Math.min(1,(e.clientX-t.left)/t.width))*h;if("start"===v){const e=Math.min(a,d);m(e)}else if("end"===v){const e=Math.max(a,s);p(e)}},H=Object(n.useCallback)(()=>{"start"===v&&b&&a&&a.seek(s).catch(e=>console.error("Seek error:",e)),A.current=!0,setTimeout(()=>{A.current=!1},100),g(null)},[v,b,a,s]);return Object(n.useEffect)(()=>{if(v)return document.addEventListener("mousemove",G),document.addEventListener("mouseup",H),()=>{document.removeEventListener("mousemove",G),document.removeEventListener("mouseup",H)}},[v,G,H]),r.a.createElement("div",{className:"App"},e?r.a.createElement("div",{className:"player-container"},l&&r.a.createElement("div",{className:"track-info"},r.a.createElement("h2",null,l.name),r.a.createElement("h3",null,l.artist)),r.a.createElement("div",{className:"timeline-container"},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px"}},r.a.createElement("span",null,X(E)),r.a.createElement("span",null,X(h))),r.a.createElement("div",{className:"timeline",onClick:e=>{if(A.current)return;const t=e.currentTarget.getBoundingClientRect(),n=(e.clientX-t.left)/t.width,r=n*h,c=d/h,l=2/t.width;Math.abs(n-c)<l||a.seek(r)},style:{position:"relative",height:"40px",background:"#ddd",cursor:"pointer",borderRadius:"20px",margin:"0 0 10px 0"}},r.a.createElement("div",{className:"progress",style:{position:"absolute",left:0,top:0,height:"100%",width:`${E/h*100}%`,background:"#1db954",borderRadius:"20px"}}),r.a.createElement("div",{className:"loop-region",style:{position:"absolute",left:`${s/h*100}%`,width:`${(d-s)/h*100}%`,height:"100%",background:"rgba(29, 185, 84, 0.3)",borderRadius:"20px"}}),r.a.createElement("div",{className:"loop-start",style:{position:"absolute",left:`${s/h*100}%`,height:"60px",top:"-10px",width:"4px",background:"#ffffff",border:"2px solid #1db954",cursor:"ew-resize",zIndex:2,borderRadius:"2px"},onMouseDown:e=>J(e,"start")}),r.a.createElement("div",{className:"loop-end",style:{position:"absolute",left:`${d/h*100}%`,height:"60px",top:"-10px",width:"4px",background:"#ffffff",border:"2px solid #1db954",cursor:"ew-resize",zIndex:2,borderRadius:"2px"},onMouseDown:e=>J(e,"end")})),r.a.createElement("div",{className:"time-display",style:{position:"relative",height:"20px",marginTop:"15px"}},Math.abs((d-s)/h)>.1?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"timestamp-container",style:{left:`${s/h*100}%`,color:"#1db954",fontWeight:"bold",cursor:"default"},title:"Use arrow keys to adjust start, Shift+arrow keys to adjust end"},r.a.createElement("span",null,q(s))),r.a.createElement("div",{className:"timestamp-container",style:{left:`${d/h*100}%`,color:"#1db954",fontWeight:"bold",cursor:"default"},title:"Use arrow keys to adjust start, Shift+arrow keys to adjust end"},r.a.createElement("span",null,q(d)))):r.a.createElement("div",{style:{position:"absolute",left:`${(s+d)/2/h*100}%`,transform:"translateX(-50%)",color:"#1db954",fontWeight:"bold"}},q(s)," - ",q(d)))),S&&r.a.createElement("div",{className:"loop-inputs"},r.a.createElement("label",null,"Loop Start (ms):",r.a.createElement("input",{type:"number",ref:L,value:s,onChange:e=>{const t=Number(e.target.value);m(t),a&&a.seek(t).catch(e=>console.error("Seek error:",e))}})),r.a.createElement("label",null,"Loop End (ms):",r.a.createElement("input",{type:"number",ref:$,value:d,onChange:e=>{const t=Number(e.target.value);p(t),a&&a.seek(t).catch(e=>console.error("Seek error:",e))}}))),r.a.createElement("div",{className:"controls",style:{marginTop:"20px",display:"flex",justifyContent:"center",gap:"15px",alignItems:"center"}},r.a.createElement("button",{onClick:z,className:"control-button","aria-label":"Previous track",title:"Previous Track"},"\u23ee"),r.a.createElement("button",{onClick:F,className:"control-button","aria-label":"Play or pause",title:(null===w||void 0===w?void 0:w.paused)?"Play":"Pause"},(null===w||void 0===w?void 0:w.paused)?"\u25b6":"\u23f8"),r.a.createElement("button",{onClick:U,className:"control-button","aria-label":"Next track",title:"Next Track"},"\u23ed"),r.a.createElement("button",{onClick:W,className:`control-button ${b?"active":""}`,"aria-label":"Toggle loop",title:b?"Stop Loop":"Start Loop"},"\ud83d\udd01"),r.a.createElement("div",{className:`count-in-group ${O?"count-in-expanded":""}`},r.a.createElement("button",{onClick:()=>x(!O),className:`control-button ${O?"active":""}`,title:"Toggle Count-in"},"\ud83c\udfb5"),O&&r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"number",value:T,onChange:e=>{const t=Math.max(1,Math.min(300,Number(e.target.value)));M(t)},title:"BPM for count-in"}),r.a.createElement("label",null,"BPM"),r.a.createElement("button",{onClick:_,className:"control-button",disabled:C,title:"Start with Count-in"},C?"1-2-3-4":"Start")))),r.a.createElement(i,null)," "):r.a.createElement("button",{onClick:()=>{window.location.href=`https://accounts.spotify.com/authorize?client_id=90578a866be642ed97064a098d97fecd&redirect_uri=${encodeURIComponent("https://karthikg89.github.io/spotify-loop-player/")}&scope=${encodeURIComponent(["user-read-playback-state","user-modify-playback-state","streaming"].join(" "))}&response_type=token`}},"Login with Spotify"))};l.a.createRoot(document.getElementById("root")).render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(m,null)))}],[[4,1,2]]]);
//# sourceMappingURL=main.6bd4cb55.chunk.js.map